<div ng-controller="LevelCtrl" class="col-xs-12">
	
	<div class="col-xs-12 bottom_line">
		<button 
		ng-click="insert()"
		class="btn btn-primary"
		>新增階層</button>
	</div>
	<div class="col-xs-12 bottom_line" ng-repeat="(level_index,level) in TagLevelList">
		<div class="col-xs-12 ">
			<button 
			ng-click="delete(level_index)"
			class="btn"
			>刪除本層</button>	
			<input type="checkbox" />自動加到下一層
		</div>
		<div class="col-xs-12 " 
		ng-init="countlist=getTagRelationCountList({level_id:level.id})"
		>
			本層
			<input type="text"
			ng-model="tag_name"
			ng-init="tag_name=''"
			ng-change="
			countlist=getTagRelationCountList({level_id:level.id,name:tag_name});
			add_tag_name_flag=false;
			"
			placeholder="搜尋資料"
			/>
			
			<button 
			ng-show="tagName[item.id]"
			class="btn"
			ng-class="$parent.select_tid==item.id?'btn-danger':'btn-primary'"
			ng-click="
			$parent.select_tid==item.id?$parent.select_tid=undefined:$parent.select_tid=item.id;
			$parent.TagRelationList=getTagRelationList({level_id:level.id,id:item.id});
			"
			ng-init="$parent.add_tag_name_flag=($parent.add_tag_name_flag || tagName[item.id]==$parent.tag_name)"
			ng-repeat="item in countlist"
			>{{tagName[item.id]}}({{item.count}})</button>
			<button
			ng-show="tag_name && !add_tag_name_flag"
			ng-click="
			add_tag_name_flag=true;
			countlist=insertTagRelationCount({name:tag_name,level_id:level.id});
			"
			class="btn btn-primary"
			>新增{{tag_name}}</button>
		</div>
		<div class="col-xs-12 " ng-show="select_tid">
			{{tagName[select_tid]?tagName[select_tid]+'的子層':''}}
			<input type="text"
			ng-model="child_tag_name"
			ng-init="child_tag_name=''"
			ng-change="
			TagRelationList=getTagRelationList({name:child_tag_name,level_id:level.id,id:select_tid});
			add_child_tag_name_flag=false;
			"
			placeholder="搜尋資料"
			/>
			<button 
			ng-show="tagName[item.child_id]"
			class="btn"
			ng-init="$parent.add_child_tag_name_flag=($parent.add_child_tag_name_flag || tagName[item.child_id]==$parent.child_tag_name)"
			ng-repeat="item in TagRelationList"
			>{{tagName[item.child_id]}}</button>
			<button
			ng-show="child_tag_name && !add_child_tag_name_flag && (child_tag_name !=tagName[select_tid])"
			ng-click="
			add_child_tag_name_flag=true;
			TagRelationList=insertTagRelation({name:child_tag_name,level_id:level.id,id:select_tid});
			"
			class="btn btn-primary"
			>新增{{child_tag_name}}</button>
		</div>
	</div>
</div>